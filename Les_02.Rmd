---
title: "Lesson_02"
output:
  html_document:
    toc: true
    toc_float: true
---

### ФУНКЦИИ С ИТЕРИРУЕМЫМИ ОБЪЕКТАМИ

`apply()` - применение функции построчно (`MARGIN=1`) или по столбцам (`MARGIN=2`) к двумерному массиву

```{r}
mat <- matrix(runif(50, 10, 100), nrow = 25, byrow = T)
mat

# сумма по строкам MARGIN =1
apply(X = mat, MARGIN = 1, FUN = sum)

# сумма по столюцам MARGIN =2
apply(X = mat, MARGIN = 2, FUN = sum)
```

аргумент `FUN` может быть как встроекной так и пользовательской функцией.

`sapply()` работает аналогично `apply()`, стой лишь разницей, что не нужно задавать размерность в накправлении которй идет выбор итерируемых элементов т.е строк или столюцов.

Выбор происходит автоматически на основании типа итерируемого объекта:

-   вектор и матрицы - элемент вектора или матрицы;

-   список - элемент списка;

-   dataframe - столбцы;

```{r}
# Пример с dataframe
 df <- data.frame(mat)
 names(df)<- LETTERS[25:24]
 df

 # Расчет среднего значения в столбце
 sapply(X = df, FUN =  mean)
# Поиск максимального значения в столбце
 sapply(df, max)
 
```

`FUN` - можно представить лямбда-функцией или пользовательской функцией:

```{r}
# Лямбда-функциия
sapply(df, function(x) sum(sin(x/100)+x**2))
```

`tapply()` - выполняет расчет над вектром, с разбиеним на подгруппы и возращает результат для каждой подгруппы:

```{r}
# Создадим столбец Group в объекте df
df$Group <- c(rep("Group_1",10), rep("Group_2",5), rep("Group_3",10))
df
# Вычисление среднего для подгрупп по колонке Y
tapply(df$Y, INDEX = df$Group, mean)
```

`lapply()` - работает аналогично `sapply()`, но возвращает список

```{r}
my_list <- list(Item_1 = 1:25, Item_2 = 99:197)

lapply(X = my_list, FUN = max)

# sapply также возвращает список,  если выставить аргумент simplify = FALSE
sapply(X = my_list, FUN = max, simplify = F)
```

`mapply()` - считается многомерной версией `sapply()` , т.е. может проводить вычисление над несколькими списками, массивами одновременно ([источник](https://www.educative.io/answers/what-is-the-mapply-function-in-r))

```{r}
# Создадим пользовательскую функцию
myfunction <- function(a, b, c) {
  a*b + c
}

# Создаем три вектора
a = c(1, 4, 0, 6)
b = c(1, 2, 3, 0)
c = c(5, 0, 4, 3)

# применяем функцию на три вектора через mapply
mapply(myfunction, a, b, c)
```

`aggregate()` - разбивает данные на подгруппы, вычисляет сводную статистику для каждой подгруппы и возвращает результат в удобной форме.

```{r}
# Расчет среднего по группам для заданной переменной (столбца), например Y
aggregate(Y ~ Group, data = df, FUN = mean)

# Расчет среднего по группам для для всех столбцов
aggregate(. ~ Group, data = df, FUN = mean)

# Расчет среднего по группам для для суммы столбцов X и Y
aggregate(X + Y ~ Group, data = df, FUN = mean)

# Расчет среднего по группам для для суммы квадратов столбцов X и Y
aggregate(X^2 + Y^2 ~ Group, data = df, FUN = mean)

```

`table()` - создает таблицу сопряженности на сновании введеных факторов. Удобен работы сдатафрймами, но может быть применен и к вектору:

```{r}
# Подсчет одинаковых элементов в векторе
table(df$Group)

df$Segment <- c(rep("Seg_1",2), rep("Seg_2",5), rep("Seg_3",16), rep("Seg_4", 2))

# Подсчет одинаковых элементов в векторе
table(df$Segment, df$Group)
```

### РАБОТА С БИБЛИОТЕКАМИ И МОДУЛЯМИ

Загрузка библиотеки:

`require({имя пакета})` загружает содержимое пакета , предпочтителен для вызова внутри функций.

``` library(``{имя пакета}``) ``` - аналогичен `require()` , используется в основном в теле скрипта.

Более подробно различие рассмотрено [здесь](https://stackoverflow.com/questions/5595512/what-is-the-difference-between-require-and-library).

`source()` - позволяет загружать/импортировать функции напрямую из `.R` файлов.

```{r}
source("C:/RWD/DataProcessing/importCDF_FUN.R")
```

Удобно написания/отладки больших процедур. Один файл отводится целиком под код процедуры/функции, второй лист для запуска (загрузки и вызова функции), таким образом исключается неоходимость каждый раз выделять часть кода в `source`для исполнения.

### ГРАФИКИ И ДИАГРАММЫ

Для построения графиков и диаграмм наиболее часто используют следующие библиотеки

`plot {base}` - базовая графика;

`ggplot2 {ggplot2 }` - продвинутая графика на основе "грамматических структур";

`{lattice}` - Trellis graphics for **R** (см. help).
